<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (24) on Tue Nov 11 06:03:06 CST 2025 -->
<title>org.efs.dispatcher (efs 0.2.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2025-11-11">
<meta name="description" content="declaration: package: org.efs.dispatcher">
<meta name="generator" content="javadoc/PackageWriter">
<link rel="stylesheet" type="text/css" href="../../../resource-files/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../resource-files/overview.css" title="Style">
<script type="text/javascript" src="../../../script-files/script.js"></script>
<script type="text/javascript" src="../../../script-files/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../script-files/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">const pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="nav-content">
<div class="nav-menu-button"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button></div>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../search.html">Search</a></li>
<li><a href="../../../help-doc.html#package">Help</a></li>
</ul>
<div class="about-language">efs<br>v. 0.2.0</div>
</div>
</div>
<div class="sub-nav">
<div class="nav-content">
<ol class="sub-nav-list">
<li><a href="package-summary.html" class="current-selection">org.efs.dispatcher</a></li>
</ol>
<div class="nav-list-search">
<input type="text" id="search-input" disabled placeholder="Search" aria-label="Search in documentation" autocomplete="off">
<input type="reset" id="reset-search" disabled value="Reset">
</div>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="main-grid">
<nav role="navigation" class="toc" aria-label="Table of contents">
<div class="toc-header">Contents</div>
<button class="hide-sidebar"><span>Hide sidebar&nbsp;</span>&#10094;</button><button class="show-sidebar">&#10095;<span>&nbsp;Show sidebar</span></button>
<ol class="toc-list">
<li><a href="#" tabindex="0">Description</a>
<ol class="toc-list">
<li><a href="#design-goals-heading" tabindex="0">Design Goals</a></li>
<li><a href="#definitions-heading" tabindex="0">Definitions</a></li>
<li><a href="#dispatcher-coding-example-heading" tabindex="0">Dispatcher Coding example</a></li>
<li><a href="#under-the-covers-heading" tabindex="0">Under the covers</a></li>
<li><a href="#dispatching-events-heading" tabindex="0">Dispatching Events</a></li>
<li><a href="#comparison-with-existing-concurrency-frameworks-heading" tabindex="0">Comparison with Existing Concurrency Frameworks</a></li>
</ol>
</li>
<li><a href="#related-package-summary" tabindex="0">Related Packages</a></li>
<li><a href="#class-summary" tabindex="0">Classes and Interfaces</a></li>
</ol>
</nav>
<main role="main">
<div class="header">
<h1 title="Package org.efs.dispatcher" class="title">Package org.efs.dispatcher</h1>
</div>
<hr>
<div class="horizontal-scroll">
<div class="package-signature">package <span class="element-name">org.efs.dispatcher</span></div>
<section class="package-description" id="package-description">
<div class="block"><a href="EfsDispatcher.html" title="class in org.efs.dispatcher"><code>Dispatcher</code></a> forwards
 <a href="../event/IEfsEvent.html" title="interface in org.efs.event"><code>events</code></a> to
 <a href="IEfsAgent.html" title="interface in org.efs.dispatcher"><code>agents</code></a> in an effectively
 single-threaded manner. This introduction explains what an
 event and agent are, how dispatcher forwards events to agents,
 and how agents are effectively single-threaded.
 <h2 id="design-goals-heading">Design Goals</h2>
 <ul>
   <li>
     To provide a framework which allows the developer to
     have a multi-threaded application but in a single-threaded
     manner. No need for synchronization, locks, conditions,
     and dealing with dead locks or race conditions.
   </li>
   <li>
     To make the framework easy to understand and easy to use.
     There are no restrictions placed on the developer.
     <a href="IEfsAgent.html" title="interface in org.efs.dispatcher"><code>IEfsAgent</code></a> and
     <a href="../event/IEfsEvent.html" title="interface in org.efs.event"><code>IEfsEvent</code></a> are
     marker interfaces. It is entirely up to the developer to
     decide how an agent and event are implemented.
   </li>
   <li>
     Shift developer focus from threads to agents which do the
     value-added work. An agent is defined by the events it
     receives and/or the events it posts.
   </li>
   <li>
     To strictly limit thread creation. Because a computer has
     a fixed number of cores, the more threads running on a
     computer, the greater the contention between threads for
     core access. Threads are created at application start as
     part of <code>EfsDispatcher</code>s and are not accessible by
     the application.
   </li>
   <li>
     To provide sufficient documenting how to use the
     dispatcher framework through explanation and coding
     examples.
 </ul>
 <h2 id="definitions-heading">Definitions</h2>
 <ul>
   <li>
     <strong>Event:</strong> Any class implementing the
     <a href="../event/IEfsEvent.html" title="interface in org.efs.event"><code>IEfsEvent</code></a> marker
     interface. An event's purpose is to transfer information,
     requests, and replies between agents.
     <br/>
      An event class should be immutable but this
     is not enforced.
   </li>
   <li>
     <strong>Agent:</strong> Any class implementing the
     <a href="IEfsAgent.html" title="interface in org.efs.dispatcher"><code>IEfsAgent</code></a> interface.
     This interface has a single method <code>name()</code> which
     returns a non-<code>null</code>, non-empty, unique agent name.
     Uniqueness is limited to the JVM.
   </li>
   <li>
     <strong>Dispatcher:</strong> Class used to forward events
     to agents.
   </li>
 </ul>
 <h2 id="dispatcher-coding-example-heading">Dispatcher Coding example</h2>
 The coding example follows on
 <a href="IEfsAgent.html" title="interface in org.efs.dispatcher"><code>IEfsAgent</code></a>'s coding
 example. The application is a financial application
 responsible for buying and selling equity stocks using
 proprietary algorithms (algos for short). The algo class
 <code>MakeMoneyAlgo</code> implements <code>IEfsAgent</code> interface
 and processes <code>IEfsEvent</code>-derived events
 <code>NewOrderEvent</code>, <code>CancelOrderEvent</code>, and
 <code>ConfigUpdateEvent</code>.
 <pre><code>import org.efs.dispatcher.EfsDispatcher;
import org.efs.dispatcher.IEfsAgent;

public final class AlgoApplication {
    private static final String DISPATCHERS_CONFIG_FILE = "./conf/dispatchers.conf";
    private static final String ALGO_DISPATCHER_NAME = "AlgoDispatcher";

    private final CountDownLatch mDoneSignal;

    public static void main(final String[] args) {
        <em>// Dispatchers are defined as typesafe configurations stored in file named above.
        // See EfsDispatcher javadocs for more on how to create dispatchers.
        // <strong>NOTE</strong>: dispatchers *must* be created prior to creating agents.
        // Note: this configuration contains a dispatcher named "AlgoDispatcher".</em>
        EfsDispatcher.loadDispatchersConfig(DISPATCHERS_CONFIG_FILE);

        <em>// Create make money algo instance and assign it to a dispatcher.</em>
        final IEfsAgent algo = new MakeMoneyAlgo();

        EfsDispatcher.register(algo, ALGO_DISPATCHER_NAME);

        <em>// Class OrderBusInterface takes new and cancel order events off a network bus and posts
        // them to the make money algo. This is done as follow:
        //
        // EfsDispatcher(MakeMoneyAlgo::onNewOrder, newOrderEvent, mAlgo);
        //
        // where newOrderEvent was taken off the wire and mAlgo is algo instance based to
        // OrderBusInterface constructor.</em>
        final OrderBusInterface orderBus = new OrderBusInterface(algo);

        <em>// Wait here for application to be shut down.</em>
        try {
            mDoneSignal().await();
        }
        catch (InterruptedException interrupt) {}

        <em>// Deregister agent from its dispatcher before shutting down the application.</em>
        EfsDispatcher.deregister(algo);

       <em>//<strong>NOTE:</strong> dispatchers cannot be shut down. Once started, they continue running for
       // application's lifetime.</em>
    }
}</code></pre>
 <h2 id="under-the-covers-heading">Under the covers</h2>
 The following diagrams show how <code>EfsDispatcher</code> and
 application agents interact. These diagrams go over an agent's
 <code>run states</code>:
 <ul>
   <li>
     <code>IDLE</code>: agent's event queue is empty.
   </li>
   <li>
     <code>READY</code>: agent's event queue is not empty and agent
     is posted to its dispatcher's run queue. Again, this agent
     appears only once on that run queue.
   </li>
   <li>
     <code>RUNNING</code>: agent is acquired by a dispatcher thread
     and is processing its event queue.
   </li>
 </ul>
 <h3 id="agent-registration-heading">Agent Registration</h3>
 <img src="doc-files/agent-register.png" alt="agent register"/>
 <h3 id="dispatching-an-event-to-an-agent-heading">Dispatching an Event to an Agent</h3>
 <p>
 Upon registering, an agent starts life in the
 <code>idle</code> state.
 </p>
 <img src="doc-files/event-dispatch.png" alt="event dispatch"/>
 <p>
 Now that the agent has an event in its event queue, it is
 moved to the
 <code>ready</code>
 state.  Because a ready <code>EfsAgent</code> appears on its
 dispatcher's run queue <em>only one time</em> that means that
 only one dispatcher thread is able to acquire that agent. This
 fact is what make agents effectively single threaded.
 </p>
 <h3 id="agent-processing-events-heading">Agent Processing Events</h3>
 <img src="doc-files/agent-processing.png" alt="agent event processing"/>
 <p>
 When an agent is acquired by a dispatcher thread, the agent
 moves to the
 <code>running</code>
 state and begins processing its event queue.
 </p>
 <h2 id="dispatching-events-heading">Dispatching Events</h2>
 So far this documentation describes how
 <code>EfsDispatcher.dispath</code> works but not how an application
 decides to which <code>IEfsAgent</code>(s) an <code>IEfsEvent</code>
 should be dispatched. Two possible solutions are:
 <ul>
   <li>
     Hard-code event delivery. After creating an event, call
     <code>EfsDispatcher.dispatch(targetAgent::onEvent, event, targetAgent</code>.
     This is a tightly coupled solution requiring code change
     to send the event to a different agent or different
     callback. On the other hand, tight coupling is the fastest
     way to get an event from its source to target.
   </li>
   <li>
     Map an event class <em>name</em> (not the class itself) to
     a list or set or <code>IEfsAgent</code>, <code>Consumer</code>
     pairs. Forwarding an event means looking up the event in
     the map and dispatching the event to each of the agent,
     callback pairs. This is a loosely coupled technique where
     source and target are independent of each other. The
     target agent decides what events it receives and the
     callback method for that event. This loose coupling
     increases the event transmission time with the map lookup.
     It also requires providing thread safety for the event
     distribution map. The simplest solution there is to use a
     lock to protect the map but that raises the risk of a
     thread attempting to acquire the lock losing its core,
     greatly increasing event delivery latency. A low latency
     solution to this mapping is not provided here.
   </li>
 </ul>
 <h2 id="comparison-with-existing-concurrency-frameworks-heading">Comparison with Existing Concurrency Frameworks</h2>
 <h3 id="lmax-disruptor-heading">LMAX Disruptor</h3>
 <a href="https://lmax-exchange.github.io/disruptor/user-guide/index.html" target="_blank">LMAX Disruptor</a>
 has excellent thread and memory discipline. The following
 diagram gives a good overview on how Disruptor operates:
 <p>
 <img src="doc-files/disruptor-architecture.png" alt="Disruptor Architecture"/>
 </p>
 <p>
 I think of Disruptor as a conveyor belt (the Disruptor ring
 buffer) with threads assigned to different stages along the
 conveyor belt, providing value-added work on the conveyor belt
 items as they pass by. This conveyor belt contains a fixed
 number of slots. So Disruptor limits threads to those working
 on the conveyor belt and limits memory to conveyor belt slots.
 Disruptor is thread-centric
 </p>
 <p>
 The main differences between Dispatcher and Disruptor are:
 </p>
 <ul>
   <li>
     Disruptor ring buffer is homogenous. Dispatcher allows
     for heterogenous events.
   </li>
   <li>
     Disruptor ring buffer contains <em>mutable</em> elements.
     This means that ring buffer elements are created once at
     application start-up and re-used throughout application
     lifetime. This minimizes object instantiation which, in
     turn, lowers need for garbage collection. Dispatcher
     encourages creation of new events. You could implement an
     event pool to support re-use but that is up to you.
   </li>
   <li>
     Disruptor supports element processing in one direction
     only. An element is copied into the next available slot
     and processed by threads in stage ordering. Dispatcher
     allows events to arrive at the agent from multiple
     sources.
   </li>
 </ul>
 <p>
 I have found Disruptor to be useful for "sink" applications
 only where data is coming in one end, placed in to the ring
 buffer, and processed to completion by stage threads. It does
 not work for applications are receiving events from multiple
 sources and event processing is focused on coordinating
 responses to these events. That said, if you are developing a
 "sink" application, then LMAX Disruptor should be considered.
 </p>
 <h3 id="staged-event-driven-architecture-seda--heading">Staged Event-Driven Architecture (SEDA)</h3>
 <a href="https://en.wikipedia.org/wiki/Staged_event-driven_architecture" target="_blank">SEDA</a>
 is similar to Dispatcher but with a more sophisticated
 control structure with respect to event queues and event
 processing.
 <p>
 <img src="doc-files/seda.png" alt="SEDA"/>
 </p>
 <p>
 The controller provides is the heart of a SEDA stage and
 performs:
 </p>
 <ul>
   <li>
     admission control: whether to admit an event to the event
     queue, and event queue ordering.
   </li>
   <li>
     run-time control: update stage scheduling parameters and
     load management.
   </li>
 </ul>
 <p>
 SEDA's focus is on resource management, adjusting parameters
 so that flow event flow meets design limits. Dispatcher
 provides no control mechanisms. That is left to the user if
 they have the need.
 </p></div>
</section>
</div>
<section class="summary">
<ul class="summary-list">
<li>
<div id="related-package-summary">
<div class="caption"><span>Related Packages</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Package</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><a href="config/package-summary.html">org.efs.dispatcher.config</a></div>
<div class="col-last even-row-color">
<div class="block">This package provides
 <a href="https://github.com/lightbend/config" target="_blank">typesafe</a>
 configuration bean classes which may be loaded from a file as
 follows:</div>
</div>
</div>
</div>
</li>
<li>
<div id="class-summary">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="class-summary-tab0" role="tab" aria-selected="true" aria-controls="class-summary.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary', 2)" class="active-table-tab">All Classes and Interfaces</button><button id="class-summary-tab1" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab1', 2)" class="table-tab">Interfaces</button><button id="class-summary-tab2" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab2', 2)" class="table-tab">Classes</button><button id="class-summary-tab3" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab3', 2)" class="table-tab">Enum Classes</button><button id="class-summary-tab5" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab5', 2)" class="table-tab">Exception Classes</button></div>
<div id="class-summary.tabpanel" role="tabpanel" aria-labelledby="class-summary-tab0">
<div class="summary-table two-column-summary">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="EfsDispatcher.html" title="class in org.efs.dispatcher">EfsDispatcher</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">This class forwards <a href="../event/IEfsEvent.html" title="interface in org.efs.event"><code>events</code></a> to
 <a href="IEfsAgent.html" title="interface in org.efs.dispatcher"><code>agents</code></a> and has each agent process those
 events in a way that is effectively single-threaded.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab2"><a href="EfsDispatcher.Builder.html" title="class in org.efs.dispatcher">EfsDispatcher.Builder</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab2">
<div class="block">Builder for constructing <a href="EfsDispatcher.html" title="class in org.efs.dispatcher"><code>EfsDispatcher</code></a> instance.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab3"><a href="EfsDispatcher.DispatcherState.html" title="enum class in org.efs.dispatcher">EfsDispatcher.DispatcherState</a></div>
<div class="col-last even-row-color class-summary class-summary-tab3">
<div class="block">A dispatcher is either stopped, started, or failed to
 start.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab3"><a href="EfsDispatcher.DispatcherType.html" title="enum class in org.efs.dispatcher">EfsDispatcher.DispatcherType</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab3">
<div class="block">Enumerates the supported efs dispatcher thread types.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="EfsDispatcherThread.html" title="class in org.efs.dispatcher">EfsDispatcherThread</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">A dispatcher thread watches a given
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentLinkedQueue.html" title="class or interface in java.util.concurrent" class="external-link"><code>run queue</code></a>
 for <code>EfsAgent</code> instances ready to run, attempting to
 acquire the next ready agent.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab3"><a href="EfsDispatcherThread.DispatcherThreadState.html" title="enum class in org.efs.dispatcher">EfsDispatcherThread.DispatcherThreadState</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab3">
<div class="block">A dispatcher thread is either not running, idle (waiting
 for an available efs agent) or busy (running an efs
 agent).</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="IEfsAgent.html" title="interface in org.efs.dispatcher">IEfsAgent</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">This interface solves the problem of start up and shutting
 down from a non-efs thread.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="IEfsDispatcher.html" title="interface in org.efs.dispatcher">IEfsDispatcher</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">Dispatcher behavior interface.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="ReplyTo.html" title="class in org.efs.dispatcher">ReplyTo</a>&lt;E extends <a href="../event/IEfsEvent.html" title="interface in org.efs.event">IEfsEvent</a>&gt;</div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">This class is used when an agent posting an event to a second
 agent expecting a reply to its event.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab5"><a href="ThreadStartException.html" title="class in org.efs.dispatcher">ThreadStartException</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab5">
<div class="block">Exception thrown when a
 <a href="EfsDispatcherThread.html" title="class in org.efs.dispatcher"><code>dispatcher thread</code></a> fails to
 start.</div>
</div>
</div>
</div>
</div>
</li>
</ul>
</section>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2025. Charles W. Rapp<br>All rights reserved</small></p>
</footer>
</main>
</div>
</body>
</html>
